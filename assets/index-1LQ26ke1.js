var v=Object.defineProperty;var C=(g,t,i)=>t in g?v(g,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):g[t]=i;var c=(g,t,i)=>C(g,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&h(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function h(s){if(s.ep)return;s.ep=!0;const e=i(s);fetch(s.href,e)}})();class R{constructor(){c(this,"canvas");c(this,"ctx");c(this,"lights",[]);c(this,"cars",[]);c(this,"animationId",null);c(this,"time",0);c(this,"isRunning",!1);c(this,"speedLimit",60);c(this,"middleLightPosition",35);c(this,"cycleTime",30);c(this,"lightOffsets",[0,6,12]);c(this,"lightCycleTimes",[30,30,30]);c(this,"lastCarSpawnTime",0);c(this,"CAR_SPAWN_INTERVAL",3*60);c(this,"PIXELS_PER_FOOT",700/15840);c(this,"FPS",60);c(this,"ROAD_MARGIN",150);c(this,"TIME_SCALE",15);c(this,"MPH_TO_PIXELS_PER_FRAME",t=>t*5280/3600*this.PIXELS_PER_FOOT*this.TIME_SCALE/this.FPS);this.canvas=document.getElementById("simulation"),this.ctx=this.canvas.getContext("2d"),this.setupControls(),this.initializeSimulation(),this.draw(),this.start()}setupControls(){const t=document.getElementById("speedLimit"),i=document.getElementById("middleLightPosition"),h=document.getElementById("leftLightOffset"),s=document.getElementById("middleLightOffset"),e=document.getElementById("rightLightOffset"),o=document.getElementById("leftLightCycle"),d=document.getElementById("middleLightCycle"),a=document.getElementById("rightLightCycle"),n=document.getElementById("speedLimitValue"),l=document.getElementById("middleLightPositionValue"),f=document.getElementById("leftLightOffsetValue"),u=document.getElementById("middleLightOffsetValue"),m=document.getElementById("rightLightOffsetValue"),L=document.getElementById("leftLightCycleValue"),S=document.getElementById("middleLightCycleValue"),y=document.getElementById("rightLightCycleValue"),p=document.getElementById("startBtn"),E=document.getElementById("pauseBtn"),T=document.getElementById("resetBtn");t.addEventListener("input",r=>{this.speedLimit=parseInt(r.target.value),n.textContent=this.speedLimit.toString();const x=this.MPH_TO_PIXELS_PER_FRAME(this.speedLimit);this.cars.forEach(I=>{I.speed=x}),this.isRunning||this.initializeSimulation()}),i.addEventListener("input",r=>{if(this.middleLightPosition=parseInt(r.target.value),l.textContent=this.middleLightPosition.toString(),this.lights.length>=2){const x=this.canvas.width-2*this.ROAD_MARGIN;this.lights[1].x=this.ROAD_MARGIN+x*this.middleLightPosition/100,this.updateMiddleLightControlPosition()}this.isRunning||this.initializeSimulation()}),h.addEventListener("input",r=>{this.lightOffsets[0]=parseInt(r.target.value),f.textContent=this.lightOffsets[0].toString()}),s.addEventListener("input",r=>{this.lightOffsets[1]=parseInt(r.target.value),u.textContent=this.lightOffsets[1].toString()}),e.addEventListener("input",r=>{this.lightOffsets[2]=parseInt(r.target.value),m.textContent=this.lightOffsets[2].toString()}),o.addEventListener("input",r=>{this.lightCycleTimes[0]=parseInt(r.target.value),L.textContent=this.lightCycleTimes[0].toString(),this.lights[0]&&(this.lights[0].cycleTime=this.lightCycleTimes[0])}),d.addEventListener("input",r=>{this.lightCycleTimes[1]=parseInt(r.target.value),S.textContent=this.lightCycleTimes[1].toString(),this.lights[1]&&(this.lights[1].cycleTime=this.lightCycleTimes[1])}),a.addEventListener("input",r=>{this.lightCycleTimes[2]=parseInt(r.target.value),y.textContent=this.lightCycleTimes[2].toString(),this.lights[2]&&(this.lights[2].cycleTime=this.lightCycleTimes[2])}),p.addEventListener("click",()=>this.start()),E.addEventListener("click",()=>this.pause()),T.addEventListener("click",()=>this.reset())}updateMiddleLightControlPosition(){}spawnCars(){const t=this.MPH_TO_PIXELS_PER_FRAME(this.speedLimit);this.cars.push({x:-50,y:this.canvas.height/2-40,speed:t,direction:1,color:"#4444ff",hitRedLight:!1}),this.cars.push({x:this.canvas.width+50,y:this.canvas.height/2+40,speed:t,direction:-1,color:"#ff44ff",hitRedLight:!1})}initializeSimulation(){this.lights=[],this.cars=[],this.time=0;const t=this.canvas.width-2*this.ROAD_MARGIN,i=this.ROAD_MARGIN+t*this.middleLightPosition/100;this.lights=[{x:this.ROAD_MARGIN,currentState:this.calculateLightState(0,0),timeInState:0,cycleTime:this.lightCycleTimes[0]},{x:i,currentState:this.calculateLightState(0,1),timeInState:0,cycleTime:this.lightCycleTimes[1]},{x:this.canvas.width-this.ROAD_MARGIN,currentState:this.calculateLightState(0,2),timeInState:0,cycleTime:this.lightCycleTimes[2]}],this.cars=[],this.lastCarSpawnTime=0}calculateLightState(t,i){let h;if(this.lights.length>i)h=this.lights[i].x;else if(i===0)h=this.ROAD_MARGIN;else if(i===1){const m=this.canvas.width-2*this.ROAD_MARGIN;h=this.ROAD_MARGIN+m*this.middleLightPosition/100}else h=this.canvas.width-this.ROAD_MARGIN;h/this.PIXELS_PER_FOOT*3600/(this.speedLimit*5280)/this.TIME_SCALE;const d=this.lightOffsets[i]||0,a=this.lightCycleTimes[i]||this.cycleTime,n=t/this.FPS;this.lightOffsets.some(m=>m!==0);const l=(n-d+a)%a,f=a*.45,u=a*.1;return l<f?"green":l<f+u?"yellow":"red"}update(){this.isRunning&&(this.time+=1,this.time-this.lastCarSpawnTime>=this.CAR_SPAWN_INTERVAL&&(this.spawnCars(),this.lastCarSpawnTime=this.time),this.lights.forEach((t,i)=>{t.currentState=this.calculateLightState(this.time,i)}),this.cars.forEach((t,i)=>{const h=t.x+t.speed*t.direction,e=Math.max(15*this.PIXELS_PER_FOOT,32),o=e*.2,d=e+o;let a=!1;for(let n=0;n<this.cars.length;n++){if(n===i)continue;const l=this.cars[n];if(l.direction===t.direction&&Math.abs(l.y-t.y)<20){if(t.direction===1){if(l.x>t.x&&l.x-h<d){a=!0;break}}else if(l.x<t.x&&h-l.x<d){a=!0;break}}}if(!a)for(const n of this.lights){const l=n.x-25,f=n.x+25;if(t.direction===1){if(t.x+e/2<l&&h+e/2>=l){if(n.currentState==="red"){a=!0,t.hitRedLight=!0;break}}else if(t.x+e/2>=l-d&&t.x+e/2<=l&&n.currentState==="red"){a=!0;break}}else if(t.x-e/2>f&&h-e/2<=f){if(n.currentState==="red"){a=!0,t.hitRedLight=!0;break}}else if(t.x-e/2<=f+d&&t.x-e/2>=f&&n.currentState==="red"){a=!0;break}}a||(t.x=h)}),this.cars=this.cars.filter(t=>t.direction===1?t.x<=this.canvas.width+100:t.x>=-100))}draw(){if(this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#444",this.ctx.fillRect(0,this.canvas.height/2-60,this.canvas.width,120),this.ctx.strokeStyle="#ffff00",this.ctx.setLineDash([20,10]),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height/2),this.ctx.lineTo(this.canvas.width,this.canvas.height/2),this.ctx.stroke(),this.ctx.setLineDash([]),this.lights.length>=2){this.ctx.strokeStyle="#888",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]);for(let t=0;t<this.lights.length-1;t++){const i=this.lights[t],h=this.lights[t+1];this.ctx.beginPath(),this.ctx.moveTo(i.x,this.canvas.height/2-110),this.ctx.lineTo(h.x,this.canvas.height/2-110),this.ctx.stroke();const e=Math.abs(h.x-i.x)/this.PIXELS_PER_FOOT,o=e/5280,a=e*3600/(this.speedLimit*5280)/this.TIME_SCALE;this.ctx.fillStyle="#fff",this.ctx.font="12px Arial",this.ctx.textAlign="center";let n;if(o>=1)n=`${o.toFixed(1)} mi`;else{const l=o;l>.75?n="3/4 mi":l>.66?n="2/3 mi":l>.5?n="1/2 mi":l>.33?n="1/3 mi":l>.25?n="1/4 mi":n=`${(l*5280).toFixed(0)} ft`}this.ctx.fillText(n,(i.x+h.x)/2,this.canvas.height/2-120),this.ctx.fillText(`${a.toFixed(1)}s @ ${this.speedLimit}mph`,(i.x+h.x)/2,this.canvas.height/2-108)}this.ctx.setLineDash([])}this.lights.forEach(t=>{this.ctx.strokeStyle="#fff",this.ctx.lineWidth=4,this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.moveTo(t.x-25,this.canvas.height/2-60),this.ctx.lineTo(t.x-25,this.canvas.height/2),this.ctx.moveTo(t.x+25,this.canvas.height/2),this.ctx.lineTo(t.x+25,this.canvas.height/2+60),this.ctx.stroke(),this.ctx.fillStyle="#666",this.ctx.fillRect(t.x-5,this.canvas.height/2-20,10,40),this.ctx.fillStyle="#333",this.ctx.fillRect(t.x-15,this.canvas.height/2-30,30,20);const i={red:"#ff4444",yellow:"#ffff44",green:"#44ff44"};this.ctx.fillStyle=i[t.currentState],this.ctx.beginPath(),this.ctx.arc(t.x,this.canvas.height/2-20,8,0,Math.PI*2),this.ctx.fill()}),this.cars.forEach(t=>{const s=Math.max(15*this.PIXELS_PER_FOOT,32),e=Math.max(6*this.PIXELS_PER_FOOT,16);if(this.ctx.fillStyle=t.hitRedLight?"#ff8888":t.color,this.ctx.fillRect(t.x-s/2,t.y-e/2,s,e),s>8){this.ctx.fillStyle="#fff";const o=s*.25,d=e*.4;this.ctx.fillRect(t.x-s/4,t.y-d/2,o,d),this.ctx.fillRect(t.x+s/8,t.y-d/2,o,d)}}),this.isRunning&&(this.animationId=requestAnimationFrame(()=>{this.update(),this.draw()}))}start(){this.isRunning||(this.isRunning=!0,document.getElementById("startBtn").disabled=!0,document.getElementById("pauseBtn").disabled=!1,this.spawnCars(),this.draw())}pause(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId),document.getElementById("startBtn").disabled=!1,document.getElementById("pauseBtn").disabled=!0}reset(){this.pause(),this.initializeSimulation(),this.draw()}}document.addEventListener("DOMContentLoaded",()=>{new R});
