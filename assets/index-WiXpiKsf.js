(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const h of e)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const h={};return e.integrity&&(h.integrity=e.integrity),e.referrerPolicy&&(h.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?h.credentials="include":e.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(e){if(e.ep)return;e.ep=!0;const h=s(e);fetch(e.href,h)}})();var R=Object.defineProperty,O=(d,t,s)=>t in d?R(d,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[t]=s,a=(d,t,s)=>O(d,typeof t!="symbol"?t+"":t,s);(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const h of e.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?e.credentials="include":i.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(i){if(i.ep)return;i.ep=!0;const e=t(i);fetch(i.href,e)}})();class T{constructor(){a(this,"canvas"),a(this,"ctx"),a(this,"lights",[]),a(this,"cars",[]),a(this,"animationId",null),a(this,"time",0),a(this,"isRunning",!1),a(this,"speedLimit",60),a(this,"middleLightPosition",35),a(this,"cycleTime",30),a(this,"lightOffsets",[0,6,12]),a(this,"lightCycleTimes",[30,30,30]),a(this,"lastCarSpawnTime",0),a(this,"CAR_SPAWN_INTERVAL",3*60),a(this,"PIXELS_PER_FOOT",700/15840),a(this,"FPS",60),a(this,"ROAD_MARGIN",150),a(this,"TIME_SCALE",15),a(this,"MPH_TO_PIXELS_PER_FRAME",t=>t*5280/3600*this.PIXELS_PER_FOOT*this.TIME_SCALE/this.FPS),this.canvas=document.getElementById("simulation"),this.ctx=this.canvas.getContext("2d"),this.setupControls(),this.initializeSimulation(),this.draw(),this.start()}setupControls(){const t=document.getElementById("speedLimit"),s=document.getElementById("middleLightPosition"),i=document.getElementById("leftLightOffset"),e=document.getElementById("middleLightOffset"),h=document.getElementById("rightLightOffset"),o=document.getElementById("leftLightCycle"),l=document.getElementById("middleLightCycle"),n=document.getElementById("rightLightCycle"),c=document.getElementById("speedLimitValue"),g=document.getElementById("middleLightPositionValue"),u=document.getElementById("leftLightOffsetValue"),m=document.getElementById("middleLightOffsetValue"),x=document.getElementById("rightLightOffsetValue"),y=document.getElementById("leftLightCycleValue"),L=document.getElementById("middleLightCycleValue"),p=document.getElementById("rightLightCycleValue"),E=document.getElementById("startBtn"),I=document.getElementById("pauseBtn"),S=document.getElementById("resetBtn");t.addEventListener("input",r=>{this.speedLimit=parseInt(r.target.value),c.textContent=this.speedLimit.toString();const f=this.MPH_TO_PIXELS_PER_FRAME(this.speedLimit);this.cars.forEach(v=>{v.speed=f}),this.isRunning||this.initializeSimulation()}),s.addEventListener("input",r=>{if(this.middleLightPosition=parseInt(r.target.value),g.textContent=this.middleLightPosition.toString(),this.lights.length>=2){const f=this.canvas.width-2*this.ROAD_MARGIN;this.lights[1].x=this.ROAD_MARGIN+f*this.middleLightPosition/100,this.updateMiddleLightControlPosition()}this.isRunning||this.initializeSimulation()}),i.addEventListener("input",r=>{this.lightOffsets[0]=parseInt(r.target.value),u.textContent=this.lightOffsets[0].toString()}),e.addEventListener("input",r=>{this.lightOffsets[1]=parseInt(r.target.value),m.textContent=this.lightOffsets[1].toString()}),h.addEventListener("input",r=>{this.lightOffsets[2]=parseInt(r.target.value),x.textContent=this.lightOffsets[2].toString()}),o.addEventListener("input",r=>{this.lightCycleTimes[0]=parseInt(r.target.value),y.textContent=this.lightCycleTimes[0].toString(),this.lights[0]&&(this.lights[0].cycleTime=this.lightCycleTimes[0])}),l.addEventListener("input",r=>{this.lightCycleTimes[1]=parseInt(r.target.value),L.textContent=this.lightCycleTimes[1].toString(),this.lights[1]&&(this.lights[1].cycleTime=this.lightCycleTimes[1])}),n.addEventListener("input",r=>{this.lightCycleTimes[2]=parseInt(r.target.value),p.textContent=this.lightCycleTimes[2].toString(),this.lights[2]&&(this.lights[2].cycleTime=this.lightCycleTimes[2])}),E.addEventListener("click",()=>this.start()),I.addEventListener("click",()=>this.pause()),S.addEventListener("click",()=>this.reset())}updateMiddleLightControlPosition(){}spawnCars(){const t=this.MPH_TO_PIXELS_PER_FRAME(this.speedLimit);this.cars.push({x:-50,y:this.canvas.height/2-40,speed:t,direction:1,color:"#4444ff",hitRedLight:!1}),this.cars.push({x:this.canvas.width+50,y:this.canvas.height/2+40,speed:t,direction:-1,color:"#ff44ff",hitRedLight:!1})}initializeSimulation(){this.lights=[],this.cars=[],this.time=0;const t=this.canvas.width-2*this.ROAD_MARGIN,s=this.ROAD_MARGIN+t*this.middleLightPosition/100;this.lights=[{x:this.ROAD_MARGIN,currentState:this.calculateLightState(0,0),timeInState:0,cycleTime:this.lightCycleTimes[0]},{x:s,currentState:this.calculateLightState(0,1),timeInState:0,cycleTime:this.lightCycleTimes[1]},{x:this.canvas.width-this.ROAD_MARGIN,currentState:this.calculateLightState(0,2),timeInState:0,cycleTime:this.lightCycleTimes[2]}],this.cars=[],this.lastCarSpawnTime=0}calculateLightState(t,s){let i;if(this.lights.length>s)i=this.lights[s].x;else if(s===0)i=this.ROAD_MARGIN;else if(s===1){const g=this.canvas.width-2*this.ROAD_MARGIN;i=this.ROAD_MARGIN+g*this.middleLightPosition/100}else i=this.canvas.width-this.ROAD_MARGIN;i/this.PIXELS_PER_FOOT*3600/(this.speedLimit*5280)/this.TIME_SCALE;const e=this.lightOffsets[s]||0,h=this.lightCycleTimes[s]||this.cycleTime,o=t/this.FPS;this.lightOffsets.some(g=>g!==0);const l=(o-e+h)%h,n=h*.45,c=h*.1;return l<n?"green":l<n+c?"yellow":"red"}update(){this.isRunning&&(this.time+=1,this.time-this.lastCarSpawnTime>=this.CAR_SPAWN_INTERVAL&&(this.spawnCars(),this.lastCarSpawnTime=this.time),this.lights.forEach((t,s)=>{t.currentState=this.calculateLightState(this.time,s)}),this.cars.forEach((t,s)=>{const i=t.x+t.speed*t.direction,e=Math.max(15*this.PIXELS_PER_FOOT,32),h=e*.2,o=e+h;let l=!1;for(let n=0;n<this.cars.length;n++){if(n===s)continue;const c=this.cars[n];if(c.direction===t.direction&&Math.abs(c.y-t.y)<20){if(t.direction===1){if(c.x>t.x&&c.x-i<o){l=!0;break}}else if(c.x<t.x&&i-c.x<o){l=!0;break}}}if(!l)for(const n of this.lights){const c=n.x-25,g=n.x+25;if(t.direction===1){if(t.x+e/2<c&&i+e/2>=c){if(n.currentState==="red"){l=!0,t.hitRedLight=!0;break}}else if(t.x+e/2>=c-o&&t.x+e/2<=c&&n.currentState==="red"){l=!0;break}}else if(t.x-e/2>g&&i-e/2<=g){if(n.currentState==="red"){l=!0,t.hitRedLight=!0;break}}else if(t.x-e/2<=g+o&&t.x-e/2>=g&&n.currentState==="red"){l=!0;break}}l||(t.x=i)}),this.cars=this.cars.filter(t=>t.direction===1?t.x<=this.canvas.width+100:t.x>=-100))}draw(){if(this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#444",this.ctx.fillRect(0,this.canvas.height/2-60,this.canvas.width,120),this.ctx.strokeStyle="#ffff00",this.ctx.setLineDash([20,10]),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height/2),this.ctx.lineTo(this.canvas.width,this.canvas.height/2),this.ctx.stroke(),this.ctx.setLineDash([]),this.lights.length>=2){this.ctx.strokeStyle="#888",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]);for(let t=0;t<this.lights.length-1;t++){const s=this.lights[t],i=this.lights[t+1];this.ctx.beginPath(),this.ctx.moveTo(s.x,this.canvas.height/2-110),this.ctx.lineTo(i.x,this.canvas.height/2-110),this.ctx.stroke();const e=Math.abs(i.x-s.x)/this.PIXELS_PER_FOOT,h=e/5280,o=e*3600/(this.speedLimit*5280)/this.TIME_SCALE;this.ctx.fillStyle="#fff",this.ctx.font="12px Arial",this.ctx.textAlign="center";let l;if(h>=1)l=`${h.toFixed(1)} mi`;else{const n=h;n>.75?l="3/4 mi":n>.66?l="2/3 mi":n>.5?l="1/2 mi":n>.33?l="1/3 mi":n>.25?l="1/4 mi":l=`${(n*5280).toFixed(0)} ft`}this.ctx.fillText(l,(s.x+i.x)/2,this.canvas.height/2-120),this.ctx.fillText(`${o.toFixed(1)}s @ ${this.speedLimit}mph`,(s.x+i.x)/2,this.canvas.height/2-108)}this.ctx.setLineDash([])}this.lights.forEach(t=>{this.ctx.strokeStyle="#fff",this.ctx.lineWidth=4,this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.moveTo(t.x-25,this.canvas.height/2-60),this.ctx.lineTo(t.x-25,this.canvas.height/2),this.ctx.moveTo(t.x+25,this.canvas.height/2),this.ctx.lineTo(t.x+25,this.canvas.height/2+60),this.ctx.stroke(),this.ctx.fillStyle="#666",this.ctx.fillRect(t.x-5,this.canvas.height/2-20,10,40),this.ctx.fillStyle="#333",this.ctx.fillRect(t.x-15,this.canvas.height/2-30,30,20);const s={red:"#ff4444",yellow:"#ffff44",green:"#44ff44"};this.ctx.fillStyle=s[t.currentState],this.ctx.beginPath(),this.ctx.arc(t.x,this.canvas.height/2-20,8,0,Math.PI*2),this.ctx.fill()}),this.cars.forEach(t=>{const s=Math.max(15*this.PIXELS_PER_FOOT,32),i=Math.max(6*this.PIXELS_PER_FOOT,16);if(this.ctx.fillStyle=t.hitRedLight?"#ff8888":t.color,this.ctx.fillRect(t.x-s/2,t.y-i/2,s,i),s>8){this.ctx.fillStyle="#fff";const e=s*.25,h=i*.4;this.ctx.fillRect(t.x-s/4,t.y-h/2,e,h),this.ctx.fillRect(t.x+s/8,t.y-h/2,e,h)}}),this.isRunning&&(this.animationId=requestAnimationFrame(()=>{this.update(),this.draw()}))}start(){this.isRunning||(this.isRunning=!0,document.getElementById("startBtn").disabled=!0,document.getElementById("pauseBtn").disabled=!1,this.spawnCars(),this.draw())}pause(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId),document.getElementById("startBtn").disabled=!1,document.getElementById("pauseBtn").disabled=!0}reset(){this.pause(),this.initializeSimulation(),this.draw()}}document.addEventListener("DOMContentLoaded",()=>{new T});
